<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="almanac">
<title>Quarterly rules • almanac</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quarterly rules">
<meta property="og:description" content="almanac">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">almanac</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/almanac.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/adjust-and-shift.html">Adjusting and shifting dates</a>
    <a class="dropdown-item" href="../articles/icalendar.html">iCalendar specification</a>
    <a class="dropdown-item" href="../articles/quarterly.html">Quarterly rules</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavisVaughan/almanac/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quarterly rules</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/almanac/blob/HEAD/vignettes/quarterly.Rmd" class="external-link"><code>vignettes/quarterly.Rmd</code></a></small>
      <div class="d-none name"><code>quarterly.Rmd</code></div>
    </div>

    
    
<p>Quarterly rules are the “hardest” to create in almanac because the
specification that it is built on top of, the <a href="https://www.rfc-editor.org/rfc/rfc5545" class="external-link">RFC-5545 iCalendar
Spec</a> does not include quarterly as a frequency. The rationale for
this is that it can always be built from a combination of monthly or
yearly rules, if a bit clunky. The goal of this vignette is just to show
a few examples of quarterly rules.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/almanac" class="external-link">almanac</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="first-day-of-the-quarter">First day of the quarter<a class="anchor" aria-label="anchor" href="#first-day-of-the-quarter"></a>
</h2>
<p>This one is particularly easy, but the reason is a bit misleading.
Let’s show it first:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_first_day_of_quarter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">monthly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="st">"2000-01-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_interval.html">recur_on_interval</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_first_day_of_quarter</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-01-01" "2000-04-01" "2000-07-01" "2000-10-01" "2001-01-01"</span></span>
<span><span class="co">#&gt; [6] "2001-04-01" "2001-07-01" "2001-10-01" "2002-01-01"</span></span></code></pre></div>
<p>Whenever you need the “first” event per quarter, there is a good
chance that that event will fall in the first month of the quarter, as
is the case here. Whenever you have a guarantee that your event falls in
the first month of the quarter, and can be computed from the start of
that month, you can probably just use
<code>monthly() %&gt;% recur_on_interval(3)</code> to get your quarterly
values.</p>
</div>
<div class="section level2">
<h2 id="altering-the-fiscal-year-start">Altering the fiscal year start<a class="anchor" aria-label="anchor" href="#altering-the-fiscal-year-start"></a>
</h2>
<p>Before moving on to more complex examples, I want to show the general
way to change the start of the fiscal year. This means that rather than
starting the quarter on January, we could start it on March. Remember
that the <code>since</code> date is used as an anchor date for things
like <code><a href="../reference/recur_on_interval.html">recur_on_interval()</a></code>, so if we chose a
<code>since</code> date in March, then we could recur with a different
fiscal calendar.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_first_day_of_quarter_march_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">monthly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="st">"2000-03-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_interval.html">recur_on_interval</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_first_day_of_quarter_march_start</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-03-01" "2000-06-01" "2000-09-01" "2000-12-01" "2001-03-01"</span></span>
<span><span class="co">#&gt; [6] "2001-06-01" "2001-09-01" "2001-12-01"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="n-th-day-of-the-quarter">N-th day of the quarter<a class="anchor" aria-label="anchor" href="#n-th-day-of-the-quarter"></a>
</h2>
<p>As a more general case of the first example, what happens if we want
to compute the N-th day of the quarter, from either the front or the
back? Unlike the first example, we no longer have the guarantee that the
date will be in the first month, and if we count from the back we really
need the entire set of 3 months that make up the quarter to count
correctly.</p>
<p>The secret here is to break the rule into 4 smaller rules, one per
quarter, which you can then combine into 1 larger quarterly runion.
Let’s start with a concrete example in Q1. How can we get the 60th day
of the quarter?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_60th_day_of_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">31</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_60th_day_of_q1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-02-29" "2001-03-01"</span></span></code></pre></div>
<p>This breaks down as follows:</p>
<ul>
<li><p>Use a <code><a href="../reference/rrule.html">yearly()</a></code> frequency rather than a
<code><a href="../reference/rrule.html">monthly()</a></code> one.</p></li>
<li><p>Recur on the 3 months that make up the first quarter.</p></li>
<li><p>Recur on all days of the month (it isn’t a problem if a month
doesn’t have day 30 or 31).</p></li>
<li><p>This gives us access to all ~90 days in the quarter (the exact
number varies per quarter). With <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> we can
take the <code>nth</code> day of that set.</p></li>
</ul>
<p>Using <code><a href="../reference/rrule.html">yearly()</a></code> rather than <code><a href="../reference/rrule.html">monthly()</a></code> is
required for <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> to work correctly.
<code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> takes the <code>n-th</code> position of
the set, <em>within the frequency</em>. So if we had chosen monthly it
would try and take the 60th position within the monthly set, which isn’t
what we wanted.</p>
<p>The rest of the quarterly rules are straightforward from here. We
just change the month of year values. To make this more usable, I’ll
also wrap it in a parameterized function, and go ahead and construct the
combined runion object from the four pieces.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_on_nth_doq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">since</span> <span class="op">=</span> <span class="st">"1970-01-01"</span>, <span class="va">nth</span> <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">all_days</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">31</span></span>
<span>  </span>
<span>  <span class="va">on_nth_day_of_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="va">all_days</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_day_of_q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="va">all_days</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_day_of_q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="va">all_days</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="va">on_nth_day_of_q4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="va">all_days</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_doq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rset.html">runion</a></span><span class="op">(</span></span>
<span>    <span class="va">on_nth_day_of_q1</span>,</span>
<span>    <span class="va">on_nth_day_of_q2</span>,</span>
<span>    <span class="va">on_nth_day_of_q3</span>,</span>
<span>    <span class="va">on_nth_day_of_q4</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_doq</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s give it a whirl.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_60th_doq</span> <span class="op">&lt;-</span> <span class="fu">make_on_nth_doq</span><span class="op">(</span>since <span class="op">=</span> <span class="st">"2000-01-01"</span>, nth <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_60th_doq</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-02-29" "2000-05-30" "2000-08-29" "2000-11-29" "2001-03-01"</span></span>
<span><span class="co">#&gt; [6] "2001-05-30" "2001-08-29" "2001-11-29"</span></span></code></pre></div>
<p>It can also select days from the end of the quarter, for example, the
last day in the quarter:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_last_doq</span> <span class="op">&lt;-</span> <span class="fu">make_on_nth_doq</span><span class="op">(</span>since <span class="op">=</span> <span class="st">"2000-01-01"</span>, nth <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_last_doq</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-03-31" "2000-06-30" "2000-09-30" "2000-12-31" "2001-03-31"</span></span>
<span><span class="co">#&gt; [6] "2001-06-30" "2001-09-30" "2001-12-31"</span></span></code></pre></div>
<p>This general strategy of using a base rule of
<code>yearly() %&gt;% recur_on_month_of_year()</code>, plus some usage
of <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> is how I have solved most of the
quarterly problems I can think of.</p>
</div>
<div class="section level2">
<h2 id="n-th-week-day-of-the-quarter">N-th week day of the quarter<a class="anchor" aria-label="anchor" href="#n-th-week-day-of-the-quarter"></a>
</h2>
<p>To showcase this strategy again, let’s figure out how to get the nth
week day of the quarter. Again, start with Q1 first, this time computing
the 6th Monday of Q1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">since</span> <span class="op">&lt;-</span> <span class="st">"2000-01-01"</span></span>
<span><span class="va">day</span> <span class="op">&lt;-</span> <span class="st">"Monday"</span></span>
<span><span class="va">nth</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span></span>
<span><span class="va">on_6th_monday_of_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_6th_monday_of_q1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-02-07" "2001-02-05"</span></span></code></pre></div>
<p>Multiple week days can be used here.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">since</span> <span class="op">&lt;-</span> <span class="st">"2000-01-01"</span></span>
<span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Monday"</span>, <span class="st">"Tuesday"</span><span class="op">)</span></span>
<span><span class="va">nth</span> <span class="op">&lt;-</span> <span class="fl">19</span></span>
<span></span>
<span><span class="va">on_19th_monday_or_tuesday_of_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_19th_monday_or_tuesday_of_q1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-03-06" "2001-03-05"</span></span></code></pre></div>
<p>Now generalize:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_on_nth_day_of_week_of_the_quarter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">since</span> <span class="op">=</span> <span class="st">"1970-01-01"</span>, </span>
<span>                                                   <span class="va">day</span> <span class="op">=</span> <span class="st">"Monday"</span>, </span>
<span>                                                   <span class="va">nth</span> <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">on_nth_of_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_of_q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_of_q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="va">on_nth_of_q4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span>since <span class="op">=</span> <span class="va">since</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/recur_on_position.html">recur_on_position</a></span><span class="op">(</span><span class="va">nth</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_of_the_quarter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rset.html">runion</a></span><span class="op">(</span></span>
<span>    <span class="va">on_nth_of_q1</span>,</span>
<span>    <span class="va">on_nth_of_q2</span>,</span>
<span>    <span class="va">on_nth_of_q3</span>,</span>
<span>    <span class="va">on_nth_of_q4</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">on_nth_of_the_quarter</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_last_friday_of_the_quarter</span> <span class="op">&lt;-</span> <span class="fu">make_on_nth_day_of_week_of_the_quarter</span><span class="op">(</span></span>
<span>  since <span class="op">=</span> <span class="st">"2000-01-01"</span>, </span>
<span>  day <span class="op">=</span> <span class="st">"Friday"</span>, </span>
<span>  nth <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fridays</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, <span class="va">on_last_friday_of_the_quarter</span><span class="op">)</span></span>
<span><span class="va">fridays</span></span>
<span><span class="co">#&gt; [1] "2000-03-31" "2000-06-30" "2000-09-29" "2000-12-29" "2001-03-30"</span></span>
<span><span class="co">#&gt; [6] "2001-06-29" "2001-09-28" "2001-12-28"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">fridays</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Fri Fri Fri Fri Fri Fri Fri Fri</span></span>
<span><span class="co">#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combining-with-other-rules">Combining with other rules<a class="anchor" aria-label="anchor" href="#combining-with-other-rules"></a>
</h2>
<p>Remember that each of these results are just rsets that can be
combined with other rules if you need to create more complex quarterly
strategies. For example, let’s take the “last Friday of the quarter”
runion and combine it with a rule for “on every Wednesday”.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_wednesdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">weekly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_day_of_week</a></span><span class="op">(</span><span class="st">"Wednesday"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_last_friday_of_quarter_or_wednesdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rset.html">runion</a></span><span class="op">(</span></span>
<span>  <span class="va">on_wednesdays</span>,</span>
<span>  <span class="va">on_last_friday_of_the_quarter</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">last_friday_or_wednesdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span></span>
<span>  <span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, </span>
<span>  <span class="va">on_last_friday_of_quarter_or_wednesdays</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">last_friday_or_wednesdays</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "2000-01-05" "2000-01-12" "2000-01-19" "2000-01-26" "2000-02-02"</span></span>
<span><span class="co">#&gt;  [6] "2000-02-09" "2000-02-16" "2000-02-23" "2000-03-01" "2000-03-08"</span></span>
<span><span class="co">#&gt; [11] "2000-03-15" "2000-03-22" "2000-03-29" "2000-03-31" "2000-04-05"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">last_friday_or_wednesdays</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Fri Wed</span></span>
<span><span class="co">#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Davis Vaughan, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
