<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for Working with Recurrence Rules • almanac</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for Working with Recurrence Rules">
<meta property="og:description" content="Provides tools for defining recurrence rules and
    recurrence bundles. Recurrence rules are a programmatic way to define
    a recurring event, like the first Monday of December. Multiple
    recurrence rules can be combined into larger recurrence bundles.
    Together, these provide a system for adjusting and generating
    sequences of dates while simultaneously skipping over dates in a
    recurrence bundle's event set.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">almanac</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/almanac.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/adjust-and-shift.html">Adjusting and Shifting Dates</a>
    </li>
    <li>
      <a href="articles/icalendar.html">iCalendar Specification</a>
    </li>
    <li>
      <a href="articles/quarterly.html">Quarterly Rules</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/almanac/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="almanac">almanac<a class="anchor" aria-label="anchor" href="#almanac"></a>
</h1></div>
<!-- badges: start -->

<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/almanac" class="external-link">almanac</a></span><span class="op">)</span></span></code></pre></div>
<p>almanac provides tools for working with recurrence rules, the fundamental building blocks used to identify calendar “events”, such as weekends or holidays.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the released version of almanac from CRAN with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"almanac"</span><span class="op">)</span></span></code></pre></div>
<p>Install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"DavisVaughan/almanac"</span><span class="op">)</span></span></code></pre></div>
<p>Mac and Windows users should not have any problems installing almanac. Linux users need libv8 to install the dependency R package, V8. See the <a href="https://github.com/jeroen/V8#debian--ubuntu" class="external-link">V8 installation instructions</a> for more information. almanac uses ES5 JavaScript, so it does <em>not</em> require any “modern” JavaScript features and should work with the “old” V8 engine provided by Ubuntu versions before 19.04.</p>
</div>
<div class="section level2">
<h2 id="recurrence-rules">Recurrence Rules<a class="anchor" aria-label="anchor" href="#recurrence-rules"></a>
</h2>
<p>Constructing recurrence rules looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Thanksgiving = "The fourth Thursday in November"</span></span>
<span><span class="va">on_thanksgiving</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rrule.html">yearly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/recur_on_ymonth.html">recur_on_ymonth</a></span><span class="op">(</span><span class="st">"November"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/recur_on_wday.html">recur_on_wday</a></span><span class="op">(</span><span class="st">"Thursday"</span>, nth <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_thanksgiving</span></span>
<span><span class="co">#&gt; &lt;rrule[yearly / 1900-01-01 / 2100-01-01]&gt;</span></span>
<span><span class="co">#&gt; - ymonth: Nov</span></span>
<span><span class="co">#&gt; - wday: Thu[4]</span></span></code></pre></div>
<p>After constructing a recurrence rule, it can be used to generate dates that are in the “event set”. For example, you can search for all Thanksgivings between 2000-2006.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2006-12-31"</span>, <span class="va">on_thanksgiving</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-11-23" "2001-11-22" "2002-11-28" "2003-11-27" "2004-11-25"</span></span>
<span><span class="co">#&gt; [6] "2005-11-24" "2006-11-23"</span></span></code></pre></div>
<p>Determine if a particular date is a part of the event set with <code><a href="reference/alma_in.html">alma_in()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Is this a Thanksgiving?</span></span>
<span><span class="fu"><a href="reference/alma_in.html">alma_in</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2000-11-23"</span><span class="op">)</span>, <span class="va">on_thanksgiving</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE</span></span></code></pre></div>
<p>You can also shift an existing sequence of dates, “stepping over” dates that are part of the event set.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wednesday_before_thanksgiving</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-11-22"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Thanksgiving was on 2000-11-23.</span></span>
<span><span class="co"># This steps over Thanksgiving to 2000-11-24.</span></span>
<span><span class="co"># Then steps 1 more day to 2000-11-25.</span></span>
<span><span class="fu"><a href="reference/alma_step.html">alma_step</a></span><span class="op">(</span><span class="va">wednesday_before_thanksgiving</span>, n <span class="op">=</span> <span class="fl">2</span>, <span class="va">on_thanksgiving</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-11-25"</span></span></code></pre></div>
<p>There is an additional “stepper” object you can create for more intuitive stepping. Combine it with <code>%s+%</code> to perform the same step done by <code><a href="reference/alma_step.html">alma_step()</a></code>. Create a stepper function with <code><a href="reference/stepper.html">stepper()</a></code>, and then use it by supplying the number of days to step.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_over_thanksgiving</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stepper.html">stepper</a></span><span class="op">(</span><span class="va">on_thanksgiving</span><span class="op">)</span></span>
<span><span class="va">wednesday_before_thanksgiving</span> <span class="op"><a href="reference/stepper.html">%s+%</a></span> <span class="fu">step_over_thanksgiving</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2000-11-25"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recurrence-bundles">Recurrence Bundles<a class="anchor" aria-label="anchor" href="#recurrence-bundles"></a>
</h2>
<p>The above example just scratches the surface of what almanac can do. Practically speaking, you’ll probably have multiple holidays and events that you’d like to combine into one big recurrence object. This is known as a <em>recurrence bundle</em>.</p>
<p>This example creates recurrence rules for weekends and Christmas, and bundles them together along with the Thanksgiving rule in such a way that we get the <em>union</em> of the underlying event sets.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_weekends</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rrule.html">weekly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/recur_on_wday.html">recur_on_weekends</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_christmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rrule.html">yearly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/recur_on_mday.html">recur_on_mday</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/recur_on_ymonth.html">recur_on_ymonth</a></span><span class="op">(</span><span class="st">"Dec"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bundle</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rbundle-set.html">runion</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span><span class="op">(</span><span class="va">on_weekends</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span><span class="op">(</span><span class="va">on_christmas</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span><span class="op">(</span><span class="va">on_thanksgiving</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bundle</span></span>
<span><span class="co">#&gt; &lt;runion[3 rschedules / 0 rdates / 0 exdates]&gt;</span></span></code></pre></div>
<p>We can create a stepper that steps over all of the events in the bundle. If these two holidays were the only ones that your company celebrated, the stepper could be viewed as a way to step forward by a “business day”.</p>
<p>For example, Christmas was on a Monday in 2006. If you wanted to step 1 business day forward from the Friday before Christmas, you’d probably like it to step over the weekend and the Christmas Monday to Tuesday. The <code>bundle</code> lets you do exactly that!</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">business_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stepper.html">stepper</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Christmas was on a Monday in 2006.</span></span>
<span><span class="co"># This is the Friday before Christmas</span></span>
<span><span class="va">friday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2006-12-22"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step forward 1 business day, going over the weekend and Christmas</span></span>
<span><span class="va">friday</span> <span class="op"><a href="reference/stepper.html">%s+%</a></span> <span class="fu">business_day</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2006-12-26"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="learning-more">Learning More<a class="anchor" aria-label="anchor" href="#learning-more"></a>
</h2>
<p>View the vignettes on <a href="https://davisvaughan.github.io/almanac/index.html" class="external-link">the website</a> to learn more about how to use almanac.</p>
<ul>
<li><p><code><a href="articles/almanac.html">vignette("almanac")</a></code></p></li>
<li><p><code><a href="articles/adjust-and-shift.html">vignette("adjust-and-shift")</a></code></p></li>
<li><p><code><a href="articles/quarterly.html">vignette("quarterly")</a></code></p></li>
<li><p><code><a href="articles/icalendar.html">vignette("icalendar")</a></code></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>almanac has developed as a composite of ideas from multiple different libraries.</p>
<p>First off, it directly embeds the <em>amazing</em> JavaScript library <a href="https://github.com/jakubroztocil/rrule" class="external-link">rrule</a> for the core event set calculations. To do this, it uses the equally awesome R package, <a href="https://github.com/jeroen/V8" class="external-link">V8</a>, from Jeroen Ooms.</p>
<p>The date shifting / adjusting functions are modeled after similar functions in <a href="https://github.com/lballabio/QuantLib" class="external-link">QuantLib</a>.</p>
<p>The fast binary search based implementations of <code><a href="reference/alma_next.html">alma_next()</a></code> and <code><a href="reference/alma_step.html">alma_step()</a></code> are inspired by Pandas and the implementation of Numpy’s <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.busday_offset.html" class="external-link">busday_offset()</a>.</p>
<p>The author of <a href="https://github.com/jameslairdsmith/gs" class="external-link">gs</a>, James Laird-Smith, has been a great collaborator as we have bounced ideas off of each other. gs attempts to solve a similar problem, but with a slightly different implementation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=almanac" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/DavisVaughan/almanac/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/DavisVaughan/almanac/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing almanac</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Davis Vaughan <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://codecov.io/gh/DavisVaughan/almanac?branch=master" class="external-link"><img src="https://codecov.io/gh/DavisVaughan/almanac/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/DavisVaughan/almanac/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/DavisVaughan/almanac/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
