<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for Working with Recurrence Rules • almanac</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for Working with Recurrence Rules">
<meta property="og:description" content='Provides tools for defining recurrence rules and recurrence
    bundles. Recurrence rules are a programatic way to define a recurring
    event, like "the first Monday of December". Multiple recurrence rules can
    be combined into larger recurrence bundles. Together, these provide a
    system for adjusting and generating sequences of dates while skipping over
    dates in event sets generated by recurrence bundles.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">almanac</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/almanac.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/adjust-and-shift.html">Adjusting and Shifting Dates</a>
    </li>
    <li>
      <a href="articles/icalendar.html">iCalendar Specification</a>
    </li>
    <li>
      <a href="articles/quarterly.html">Quarterly Rules</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/almanac/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="almanac" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#almanac" class="anchor"></a>almanac</h1></div>
<!-- badges: start -->

<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">almanac</span>)</pre></div>
<p>almanac provides tools for working with recurrence rules, the fundamental building blocks used to identify calendar “events”, such as weekends or holidays.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>almanac is not yet on CRAN.</p>
<p>Install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># install.packages("remotes")</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"DavisVaughan/almanac"</span>)</pre></div>
<p>Mac (OS-X) and Windows users should not have any problems installing almanac. Linux users need libv8 to install the dependency R package, V8. See the <a href="https://github.com/jeroen/V8#debian--ubuntu">V8 installation instructions</a> for more information. almanac uses ES5 JavaScript, so it does <em>not</em> require any “modern” JavaScript features and should work with the “old” V8 engine provided by Ubuntu versions before 19.04.</p>
</div>
<div id="recurrence-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#recurrence-rules" class="anchor"></a>Recurrence Rules</h2>
<p>Constructing recurrence rules looks a little like this:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co"># Thanksgiving = "The fourth Thursday in November"</span>
<span class="no">on_thanksgiving</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrule.html">yearly</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="st">"November"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/recur_on_wday.html">recur_on_wday</a></span>(<span class="st">"Thursday"</span>, <span class="kw">nth</span> <span class="kw">=</span> <span class="fl">4</span>)

<span class="no">on_thanksgiving</span>
<span class="co">#&gt; &lt;rrule[yearly / 1970-01-01 / 2040-01-01]&gt;</span>
<span class="co">#&gt; - ymonth: Nov</span>
<span class="co">#&gt; - wday: Thu[4]</span></pre></div>
<p>After constructing a recurrence rule, it can be used to generate dates that are in the “event set”. For example, you can search for all Thanksgivings between 2000-2006.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="reference/alma_search.html">alma_search</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2006-12-31"</span>, <span class="no">on_thanksgiving</span>)
<span class="co">#&gt; [1] "2000-11-23" "2001-11-22" "2002-11-28" "2003-11-27" "2004-11-25"</span>
<span class="co">#&gt; [6] "2005-11-24" "2006-11-23"</span></pre></div>
<p>Determine if a particular date is a part of the event set with <code><a href="reference/alma_in.html">alma_in()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="co"># Is this a Thanksgiving?</span>
<span class="fu"><a href="reference/alma_in.html">alma_in</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2000-11-23"</span>), <span class="no">on_thanksgiving</span>)
<span class="co">#&gt; [1] FALSE  TRUE</span></pre></div>
<p>You can also shift an existing sequence of dates, “stepping over” dates that are part of the event set.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">wednesday_before_thanksgiving</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2000-11-22"</span>)

<span class="co"># Thanksgiving was on 2000-11-23.</span>
<span class="co"># This steps over Thanksgiving to 2000-11-24.</span>
<span class="co"># Then steps 1 more day to 2000-11-25.</span>
<span class="fu"><a href="reference/alma_step.html">alma_step</a></span>(<span class="no">wednesday_before_thanksgiving</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="no">on_thanksgiving</span>)
<span class="co">#&gt; [1] "2000-11-25"</span></pre></div>
<p>There is an additional “stepper” object you can create for more intuitive stepping. Combine it with <code><a href="reference/stepper.html">%s+%</a></code> to perform the same step done by <code><a href="reference/alma_step.html">alma_step()</a></code>. Create a stepper function with <code><a href="reference/stepper.html">stepper()</a></code>, and then use it by supplying the number of days to step.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">step_over_thanksgiving</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stepper.html">stepper</a></span>(<span class="no">on_thanksgiving</span>)
<span class="no">wednesday_before_thanksgiving</span> <span class="kw">%s+%</span> <span class="fu">step_over_thanksgiving</span>(<span class="fl">2</span>)
<span class="co">#&gt; [1] "2000-11-25"</span></pre></div>
</div>
<div id="recurrence-bundles" class="section level2">
<h2 class="hasAnchor">
<a href="#recurrence-bundles" class="anchor"></a>Recurrence Bundles</h2>
<p>The above example just scratches the surface of what almanac can do. Practically speaking, you’ll probably have multiple holidays and events that you’d like to combine into one bit recurrence object. This is known as a <em>recurrence bundle</em>.</p>
<p>This example creates recurrence rules for weekends and Christmas, and bundles them together along with the Thanksgiving rule.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="no">on_weekends</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrule.html">weekly</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/recur_on_wday.html">recur_on_weekends</a></span>()

<span class="no">on_christmas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rrule.html">yearly</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/recur_on_mday.html">recur_on_mday</a></span>(<span class="fl">25</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="st">"Dec"</span>)

<span class="no">bundle</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/rbundle.html">rbundle</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span>(<span class="no">on_weekends</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span>(<span class="no">on_christmas</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="reference/rbundle-add.html">add_rschedule</a></span>(<span class="no">on_thanksgiving</span>)

<span class="no">bundle</span>
<span class="co">#&gt; &lt;rbundle[3 rschedules / 0 rdates / 0 exdates]&gt;</span></pre></div>
<p>We can create a stepper that steps over all of the events in the bundle. If these two holidays were the only ones that your company celebrated, the stepper could be viewed as a way to step forward by a “business day”.</p>
<p>For example, Christmas was on a Monday in 2006. If you wanted to step 1 business day forward from the Friday before Christmas, you’d probably like it to step over the weekend and the Christmas Monday to Tuesday. The <code>bundle</code> lets you do exactly that!</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="no">business_day</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/stepper.html">stepper</a></span>(<span class="no">bundle</span>)

<span class="co"># Christmas was on a Monday in 2006.</span>
<span class="co"># This is the Friday before Christmas</span>
<span class="no">friday</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2006-12-22"</span>)

<span class="co"># Step forward 1 business day, going over the weekend and Christmas</span>
<span class="no">friday</span> <span class="kw">%s+%</span> <span class="fu">business_day</span>(<span class="fl">1</span>)
<span class="co">#&gt; [1] "2006-12-26"</span></pre></div>
</div>
<div id="learning-more" class="section level2">
<h2 class="hasAnchor">
<a href="#learning-more" class="anchor"></a>Learning More</h2>
<p>View the vignettes on <a href="https://davisvaughan.github.io/almanac/index.html">the website</a> to learn more about how to use almanac.</p>
<ul>
<li><p><code><a href="articles/almanac.html">vignette("almanac")</a></code></p></li>
<li><p><code><a href="articles/adjust-and-shift.html">vignette("adjust-and-shift")</a></code></p></li>
<li><p><code><a href="articles/quarterly.html">vignette("quarterly")</a></code></p></li>
<li><p><code><a href="articles/icalendar.html">vignette("icalendar")</a></code></p></li>
</ul>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>almanac has developed as a composite of ideas from multiple different libraries.</p>
<p>First off, it directly embeds the <em>amazing</em> JavaScript library <a href="https://github.com/jakubroztocil/rrule">rrule</a> for the core event set calculations. To do this, it uses the equally awesome R package, <a href="https://github.com/jeroen/V8">V8</a>, from Jeroen Ooms.</p>
<p>The date shifting / adjusting functions are modeled after similar functions in <a href="https://github.com/lballabio/QuantLib">QuantLib</a>.</p>
<p>The fast binary search based implementations of <code><a href="reference/alma_next.html">alma_next()</a></code> and <code><a href="reference/alma_step.html">alma_step()</a></code> are inspired by Pandas and the implementation of Numpy’s <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.busday_offset.html">busday_offset()</a>.</p>
<p>The author of <a href="https://github.com/jameslairdsmith/gs">gs</a>, James Laird-Smith, has been a great collaborator as we have bounced ideas off of each other. gs attempts to solve a similar problem, but with a slightly different implementation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/DavisVaughan/almanac/">https://​github.com/​DavisVaughan/​almanac/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/DavisVaughan/almanac/issues">https://​github.com/​DavisVaughan/​almanac/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Davis Vaughan <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://codecov.io/gh/DavisVaughan/almanac?branch=master"><img src="https://codecov.io/gh/DavisVaughan/almanac/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/DavisVaughan/almanac/actions"><img src="https://github.com/DavisVaughan/almanac/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
