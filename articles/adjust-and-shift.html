<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="almanac">
<title>Adjusting and shifting dates • almanac</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjusting and shifting dates">
<meta property="og:description" content="almanac">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">almanac</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/almanac.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/adjust-and-shift.html">Adjusting and shifting dates</a>
    <a class="dropdown-item" href="../articles/holidays-calendars.html">Holidays and calendars</a>
    <a class="dropdown-item" href="../articles/icalendar.html">iCalendar specification</a>
    <a class="dropdown-item" href="../articles/quarterly.html">Quarterly rules</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DavisVaughan/almanac/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Adjusting and shifting dates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/almanac/blob/HEAD/vignettes/adjust-and-shift.Rmd" class="external-link"><code>vignettes/adjust-and-shift.Rmd</code></a></small>
      <div class="d-none name"><code>adjust-and-shift.Rmd</code></div>
    </div>

    
    
<p>If you have read the introduction vignette,
<code><a href="../articles/almanac.html">vignette("almanac")</a></code>, then you’ve seen rrules, runions,
rintersects, rsetdiffs, and the functions <code><a href="../reference/alma_search.html">alma_search()</a></code>,
<code><a href="../reference/alma_events.html">alma_events()</a></code>, and <code><a href="../reference/alma_in.html">alma_in()</a></code>. Additionally
included in almanac are a set of tools for <em>adjusting</em> and
<em>shifting</em> dates. These functions are broken down as:</p>
<ul>
<li><p>Adjustment functions, such as <code><a href="../reference/adjustments.html">adj_following()</a></code> and
<code><a href="../reference/adjustments.html">adj_nearest()</a></code></p></li>
<li><p>Adjusted rschedules</p></li>
<li><p><code><a href="../reference/alma_step.html">alma_step()</a></code></p></li>
<li><p><code><a href="../reference/stepper.html">stepper()</a></code></p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/almanac" class="external-link">almanac</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="adjusting">Adjusting<a class="anchor" aria-label="anchor" href="#adjusting"></a>
</h2>
<p>“Adjusting” a date defines the behavior of what happens if a date
lands on an event in a rschedule’s event set. For example, if you have a
date that is currently on Christmas, you could adjust forward to the
next non-event date, adjust backwards to the previous non-event date, or
adjust to the nearest non-event date. The logic of how to perform these
adjustments is encoded into the following adjustment functions:</p>
<ul>
<li>
<p><code><a href="../reference/adjustments.html">adj_following()</a></code></p>
<p>Choose the first non-event date after <code>x</code>.</p>
</li>
<li>
<p><code><a href="../reference/adjustments.html">adj_preceding()</a></code></p>
<p>Choose the first non-event date before <code>x</code>.</p>
</li>
<li>
<p><code><a href="../reference/adjustments.html">adj_modified_following()</a></code></p>
<p>Choose the first non-event date after <code>x</code>, unless it falls
in a different month, in which case the first non-event date before
<code>x</code> is chosen instead.</p>
</li>
<li>
<p><code><a href="../reference/adjustments.html">adj_modified_preceding()</a></code></p>
<p>Choose the first non-event date before <code>x</code>, unless it
falls in a different month, in which case the first non-event date after
<code>x</code> is chosen instead.</p>
</li>
<li>
<p><code><a href="../reference/adjustments.html">adj_nearest()</a></code></p>
<p>Choose the nearest non-event date to <code>x</code>. If the closest
preceding and following non-event dates are equally far away, the
following non-event date is chosen.</p>
</li>
<li>
<p><code><a href="../reference/adjustments.html">adj_none()</a></code></p>
<p>Performs no adjustment and returns <code>x</code> unchanged.</p>
</li>
</ul>
<p>To use an adjustment function, you’ll need an rschedule that contains
the event set you are interested in adjusting around. Then provide that,
along with the dates you are interested in adjusting, to an
<code>adj_*()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_christmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">yearly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_month.html">recur_on_day_of_month</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_month_of_year.html">recur_on_month_of_year</a></span><span class="op">(</span><span class="st">"Dec"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-12-24"</span>, <span class="st">"2019-12-25"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/adjustments.html">adj_following</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">on_christmas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-12-24" "2019-12-26"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/adjustments.html">adj_preceding</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">on_christmas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-12-24" "2019-12-24"</span></span></code></pre></div>
<p>The <code><a href="../reference/adjustments.html">adj_nearest()</a></code> function is particularly useful when
you have a date on a weekend and want to roll it back to Friday if it
falls on Saturday but roll it forward to Monday if it falls on
Sunday.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Saturday / Sunday</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-12-21"</span>, <span class="st">"2019-12-22"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_weekends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rrule.html">weekly</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/recur_on_day_of_week.html">recur_on_weekends</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Roll Saturday backwards and Sunday forwards</span></span>
<span><span class="fu"><a href="../reference/adjustments.html">adj_nearest</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">on_weekends</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-12-20" "2019-12-23"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjusted-rschedules">Adjusted rschedules<a class="anchor" aria-label="anchor" href="#adjusted-rschedules"></a>
</h2>
<p>In the introduction vignette, you were introduced to a number of
different rschedules. As a reminder, an rschedule is just a general term
for an rrule or an rset. There is actually a third type of rschedule in
almanac, called radjusted, which is useful when combined with the
adjustment functions.</p>
<p>To motivate it, imagine your company deems Christmas to be a holiday.
Whenever Christmas rolls around on the 25th of December, you get that
day off. But what happens when Christmas falls on a Saturday? What about
Sunday? Most corporations will <em>observe</em> a holiday that falls on
the weekend on the nearest working day instead of on the weekend date
that it actually occurred on.</p>
<p>In almanac, it seems like this would pose a problem. You can create
rrules for Christmas and for weekends, but an rset like runion,
rintersect, or rsetdiff would perform some kind of set operation on
them. What you really need is a way to say: recur on the dates defined
by this rschedule, <em>unless</em> it intersects with this second
rschedule. In those cases, apply an <em>adjustment</em> to the
intersected dates to create valid dates. This is the job of
radjusted.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">on_adjusted_christmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/radjusted.html">radjusted</a></span><span class="op">(</span></span>
<span>  rschedule <span class="op">=</span> <span class="va">on_christmas</span>, </span>
<span>  adjust_on <span class="op">=</span> <span class="va">on_weekends</span>,</span>
<span>  adjustment <span class="op">=</span> <span class="va">adj_nearest</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_adjusted_christmas</span></span>
<span><span class="co">#&gt; &lt;radjusted&gt;</span></span>
<span><span class="co">#&gt;  <span style="text-decoration: underline;">adjust:</span></span></span>
<span><span class="co">#&gt;  &lt;rrule&gt;</span></span>
<span><span class="co">#&gt;  • frequency: yearly</span></span>
<span><span class="co">#&gt;  • range: [1900-01-01, 2100-01-01]</span></span>
<span><span class="co">#&gt;  • month of year: Dec</span></span>
<span><span class="co">#&gt;  • day of month: 25</span></span>
<span><span class="co">#&gt;  <span style="text-decoration: underline;">adjust on:</span></span></span>
<span><span class="co">#&gt;  &lt;rrule&gt;</span></span>
<span><span class="co">#&gt;  • frequency: weekly</span></span>
<span><span class="co">#&gt;  • range: [1900-01-01, 2100-01-01]</span></span>
<span><span class="co">#&gt;  • day of week: Sat, and Sun</span></span></code></pre></div>
<p>This is just another rschedule, so it can be used with all of the
other <code>alma_*()</code> functions we’ve seen so far. For example, we
can confirm that Christmas dates that fall on the weekend are adjusted
appropriately by searching for a few of them.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note 2004-12-24, which was rolled back from 2004-12-25, a Saturday.</span></span>
<span><span class="co"># Note 2005-12-26, which was rolled forward from 2005-12-25, a Sunday.</span></span>
<span><span class="fu"><a href="../reference/alma_search.html">alma_search</a></span><span class="op">(</span><span class="st">"2002-01-01"</span>, <span class="st">"2008-01-01"</span>, <span class="va">on_adjusted_christmas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2002-12-25" "2003-12-25" "2004-12-24" "2005-12-26" "2006-12-25"</span></span>
<span><span class="co">#&gt; [6] "2007-12-25"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="stepping">Stepping<a class="anchor" aria-label="anchor" href="#stepping"></a>
</h2>
<p><code><a href="../reference/alma_step.html">alma_step()</a></code> allows you to take an existing vector of
dates and shift it by a number of days, “stepping over” any events in
the event set defined by an rschedule. This is generally useful for
shifting by “N business days”, where the logic for a business day is
encapsulated in the rschedule.</p>
<p>You can think of <code><a href="../reference/alma_step.html">alma_step()</a></code> as a way to replace
lubridate’s <code>x + days(5)</code> with
<code>x + business_days(5)</code> where <code>business_days()</code> is
specific to your company’s holiday calendar.</p>
<p>In the following example, we shift a Thursday and Friday by 1 working
day. Notice that Friday is shifted forward to Monday.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A Thursday / Friday pair</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-12-19"</span>, <span class="st">"2019-12-20"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Shift by 1 working day, stepping over weekends</span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alma_step.html">alma_step</a></span><span class="op">(</span><span class="va">x</span>, n <span class="op">=</span> <span class="fl">1</span>, rschedule <span class="op">=</span> <span class="va">on_weekends</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  x_wday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">x</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  step <span class="op">=</span> <span class="va">step</span>,</span>
<span>  step_wday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">step</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;            x x_wday       step step_wday</span></span>
<span><span class="co">#&gt; 1 2019-12-19    Thu 2019-12-20       Fri</span></span>
<span><span class="co">#&gt; 2 2019-12-20    Fri 2019-12-23       Mon</span></span></code></pre></div>
<p>Internally, <code>n</code> is applied 1 day at a time.
<code><a href="../reference/adjustments.html">adj_following()</a></code> is called after each 1 day shift if
<code>n</code> is positive, otherwise <code><a href="../reference/adjustments.html">adj_preceding()</a></code> is
called.</p>
<p>To break this down, we’ll analyze the Friday.</p>
<ul>
<li><p>Start on <code>2019-12-20</code>, a Friday.</p></li>
<li><p>Step forward 1 day, to <code>2019-12-21</code>, a
Saturday.</p></li>
<li><p>Apply <code><a href="../reference/adjustments.html">adj_following()</a></code>, landing us on Monday,
<code>2019-12-23</code>.</p></li>
</ul>
<p>You can shift backwards with a negative <code>n</code>. It’s also
fully vectorized, and you can use different signs of <code>n</code> in
the same call. For an example, let’s consider what happens if you start
on a non-event date. Here, we start on a Saturday and Sunday, and apply
a +1 and -1 day shift to them, respectively.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A Saturday / Sunday pair</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2019-12-21"</span>, <span class="st">"2019-12-22"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/alma_step.html">alma_step</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">on_weekends</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  x_wday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">x</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  step <span class="op">=</span> <span class="va">step</span>,</span>
<span>  step_wday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">wday</a></span><span class="op">(</span><span class="va">step</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;            x x_wday       step step_wday</span></span>
<span><span class="co">#&gt; 1 2019-12-21    Sat 2019-12-23       Mon</span></span>
<span><span class="co">#&gt; 2 2019-12-22    Sun 2019-12-20       Fri</span></span></code></pre></div>
<p>For Saturday, we apply the 1 day shift, landing on Sunday, and then
call <code><a href="../reference/adjustments.html">adj_following()</a></code>, landing on Monday.</p>
<p>For Sunday, we apply the -1 day shift, landing on Saturday, and then
call <code><a href="../reference/adjustments.html">adj_preceding()</a></code>, landing on Friday.</p>
</div>
<div class="section level2">
<h2 id="steppers">Steppers<a class="anchor" aria-label="anchor" href="#steppers"></a>
</h2>
<p><code><a href="../reference/alma_step.html">alma_step()</a></code> is nice, but it would be really nice to have
something like lubridate’s <code>x + days(5)</code> syntax, but relative
to an rschedule. Due to some issues with how R’s S3 dispatch system
works with <code>+</code>, this isn’t exactly replicable with almanac,
but you can get close (lubridate uses R’s S4 object oriented system to
get it to work, but I don’t want to go there).</p>
<p>First off, you need an object the holds information about how to
shift relative to an rschedule. You can create one of these with
<code><a href="../reference/stepper.html">stepper()</a></code>. The only thing you give <code><a href="../reference/stepper.html">stepper()</a></code>
is the rschedule to step relative to. It returns a function of 1
argument, <code>n</code>, which you’ll call with the desired number of
days to shift. The resulting object can be added to or subtracted from
your vector of dates. It sounds a little complicated, but hopefully
things will clear up with an example. Let’s reproduce the last example
from the previous section:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">working_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stepper.html">stepper</a></span><span class="op">(</span><span class="va">on_weekends</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="../reference/stepper.html">%s+%</a></span> <span class="fu">working_day</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-12-23" "2019-12-20"</span></span></code></pre></div>
<p>Notice the usage of <code>%s+%</code>. This replaces <code>+</code>,
and allows you to step forward. There is also a <code>%s-%</code> for
stepping backwards.</p>
<p>The nice thing about <code>working_day</code> is that you can
continue to use it on other date vectors.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A Wednesday</span></span>
<span><span class="va">wednesday</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-18"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Returns Thursday, Friday, Monday</span></span>
<span><span class="va">wednesday</span> <span class="op"><a href="../reference/stepper.html">%s+%</a></span> <span class="fu">working_day</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-12-19" "2019-12-20" "2019-12-23"</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Davis Vaughan, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
