<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quarterly Rules • almanac</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quarterly Rules">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">almanac</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/almanac.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adjust-and-shift.html">Adjusting and Shifting Dates</a>
    </li>
    <li>
      <a href="../articles/quarterly.html">Quarterly Rules</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/almanac">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Quarterly Rules</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DavisVaughan/almanac/blob/master/vignettes/quarterly.Rmd"><code>vignettes/quarterly.Rmd</code></a></small>
      <div class="hidden name"><code>quarterly.Rmd</code></div>

    </div>

    
    
<p>Quarterly rules are the “hardest” to create in almanac because the specification that it is built on top of, the <a href="https://tools.ietf.org/html/rfc5545">RFC-5545 iCalendar Spec</a> does not include quarterly as a frequency. The rationale for this is that it can always be built from a combination of monthly or yearly rules, if a bit clunky. The goal of this vignette is just to show a few examples of quarterly rules.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(almanac)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lubridate, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="first-day-of-the-quarter" class="section level2">
<h2 class="hasAnchor">
<a href="#first-day-of-the-quarter" class="anchor"></a>First day of the quarter</h2>
<p>This one is particularly easy, but the reason is a bit misleading. Let’s show it first:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">on_first_day_of_quarter &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">monthly</a></span>(<span class="dt">since =</span> <span class="st">"2000-01-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_interval.html">recur_on_interval</a></span>(<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_first_day_of_quarter)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; [1] "2000-01-01" "2000-04-01" "2000-07-01" "2000-10-01" "2001-01-01"</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; [6] "2001-04-01" "2001-07-01" "2001-10-01" "2002-01-01"</span></a></code></pre></div>
<p>Whenever you need the “first” event per quarter, there is a good chance that that event will fall in the first month of the quarter, as is the case here. Whenever you have a guarantee that your event falls in the first month of the quarter, and can be computed from the start of that month, you can probably just use <code>monthly() %&gt;% recur_on_interval(3)</code> to get your quarterly values.</p>
</div>
<div id="altering-the-fiscal-year-start" class="section level2">
<h2 class="hasAnchor">
<a href="#altering-the-fiscal-year-start" class="anchor"></a>Altering the fiscal year start</h2>
<p>Before moving on to more complex examples, I want to show the general way to change the start of the fiscal year. This means that rather than starting the quarter on January, we could start it on March. Remember that the <code>since</code> date is used as an anchor date for things like <code><a href="../reference/recur_on_interval.html">recur_on_interval()</a></code>, so if we chose a <code>since</code> date in March, then we could recur with a different fiscal calendar.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">on_first_day_of_quarter_march_start &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">monthly</a></span>(<span class="dt">since =</span> <span class="st">"2000-03-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_interval.html">recur_on_interval</a></span>(<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_first_day_of_quarter_march_start)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [1] "2000-03-01" "2000-06-01" "2000-09-01" "2000-12-01" "2001-03-01"</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; [6] "2001-06-01" "2001-09-01" "2001-12-01"</span></a></code></pre></div>
</div>
<div id="n-th-day-of-the-quarter" class="section level2">
<h2 class="hasAnchor">
<a href="#n-th-day-of-the-quarter" class="anchor"></a>N-th day of the quarter</h2>
<p>As a more general case of the first example, what happens if we want to compute the n-th day of the quarter, from either the front or the back? Unlike the first example, we no longer have the guarantee that the date will be in the first month, and if we count from the back we really need the entire set of 3 months that make up the quarter to count correctly.</p>
<p>The secret here is to break the rule into 4 smaller rules, one per quarter, which you can then combine into 1 larger quarterly schedule. Let’s start with a concrete example in Q1, the 60th day of the quarter.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">on_60th_day_of_q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> <span class="st">"2000-01-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">31</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(<span class="dv">60</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_60th_day_of_q1)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; [1] "2000-02-29" "2001-03-01"</span></a></code></pre></div>
<p>This breaks down as follows:</p>
<ul>
<li><p>Use a <code><a href="../reference/rrule.html">yearly()</a></code> frequency rather than a <code><a href="../reference/rrule.html">monthly()</a></code> one.</p></li>
<li><p>Recur on the 3 months in the first quarter.</p></li>
<li><p>Recur on all days of the month (if a month doesn’t have mday 30 or 31 it is ignored)</p></li>
<li><p>This gives us ~90 days (depending on the quarter), now take the <code>nth</code> day of that set.</p></li>
</ul>
<p>Using <code><a href="../reference/rrule.html">yearly()</a></code> rather than <code><a href="../reference/rrule.html">monthly()</a></code> is required for <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> to work correctly. <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> takes the <code>n-th</code> position of the set, <em>within the frequency</em>. So if we had chosen monthly it would try and take the 60th position within the monthly set, which isn’t what we wanted.</p>
<p>The rest of the quarterly rules are straightforward from here. We just change the ymonth values. To make this more usable, I’ll also wrap it in a parameterized function, and go ahead and construct the combined schedule object from the four pieces.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">make_on_nth_day_of_the_quarter &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">since =</span> <span class="st">"1970-01-01"</span>, <span class="dt">nth =</span> 1L) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  all_days &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">31</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  on_nth_day_of_q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(all_days) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  on_nth_day_of_q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(all_days) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  on_nth_day_of_q3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(all_days) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    </a>
<a class="sourceLine" id="cb5-19" data-line-number="19">  on_nth_day_of_q4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">10</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_mday.html">recur_on_mday</a></span>(all_days) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  on_nth_day_of_the_quarter &lt;-<span class="st"> </span><span class="kw"><a href="../reference/schedule.html">schedule</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_day_of_q1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_day_of_q2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_day_of_q3) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_day_of_q4)</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb5-30" data-line-number="30">  on_nth_day_of_the_quarter</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">}</a></code></pre></div>
<p>Let’s give it a whirl.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">on_60th_day_of_the_quarter &lt;-<span class="st"> </span><span class="kw">make_on_nth_day_of_the_quarter</span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">since =</span> <span class="st">"2000-01-01"</span>, </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">nth =</span> <span class="dv">60</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_60th_day_of_the_quarter)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; [1] "2000-02-29" "2000-05-30" "2000-08-29" "2000-11-29" "2001-03-01"</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; [6] "2001-05-30" "2001-08-29" "2001-11-29"</span></a></code></pre></div>
<p>It can also select days from the end of the quarter, for example, the last day in the quarter.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">on_last_day_of_the_quarter &lt;-<span class="st"> </span><span class="kw">make_on_nth_day_of_the_quarter</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">since =</span> <span class="st">"2000-01-01"</span>, </a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">nth =</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_last_day_of_the_quarter)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [1] "2000-03-31" "2000-06-30" "2000-09-30" "2000-12-31" "2001-03-31"</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; [6] "2001-06-30" "2001-09-30" "2001-12-31"</span></a></code></pre></div>
<p>This general strategy of using a base rule of <code>yearly() %&gt;% recur_on_ymonth()</code>, plus some usage of <code><a href="../reference/recur_on_position.html">recur_on_position()</a></code> is how I have solved most of the quarterly problems I can think of.</p>
</div>
<div id="n-th-week-day-of-the-quarter" class="section level2">
<h2 class="hasAnchor">
<a href="#n-th-week-day-of-the-quarter" class="anchor"></a>N-th week day of the quarter</h2>
<p>To showcase this strategy again, let’s figure out how to get the nth week day of the quarter. Again, start with Q1 first, this time computing the 6th Monday of Q1.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">since &lt;-<span class="st"> "2000-01-01"</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">wday &lt;-<span class="st"> "Monday"</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">nth &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">on_6th_monday_of_q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_6th_monday_of_q1)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; [1] "2000-02-07" "2001-02-05"</span></a></code></pre></div>
<p>Multiple week days can be used here.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">since &lt;-<span class="st"> "2000-01-01"</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">wday &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Monday"</span>, <span class="st">"Tuesday"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">nth &lt;-<span class="st"> </span><span class="dv">19</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">on_19th_monday_or_tuesday_of_q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_19th_monday_or_tuesday_of_q1)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; [1] "2000-03-06" "2001-03-05"</span></a></code></pre></div>
<p>Now generalize:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">make_on_nth_wday_of_the_quarter &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">since =</span> <span class="st">"1970-01-01"</span>, <span class="dt">wday =</span> <span class="st">"Monday"</span>, <span class="dt">nth =</span> 1L) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  on_nth_wday_of_q1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  on_nth_wday_of_q2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  on_nth_wday_of_q3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">    </a>
<a class="sourceLine" id="cb10-17" data-line-number="17">  on_nth_wday_of_q4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">yearly</a></span>(<span class="dt">since =</span> since) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_ymonth.html">recur_on_ymonth</a></span>(<span class="dv">10</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="st">    </span><span class="kw"><a href="../reference/recur_on_position.html">recur_on_position</a></span>(nth)</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb10-22" data-line-number="22">  on_nth_wday_of_the_quarter &lt;-<span class="st"> </span><span class="kw"><a href="../reference/schedule.html">schedule</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_wday_of_q1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_wday_of_q2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_wday_of_q3) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="st">    </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_nth_wday_of_q4)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb10-28" data-line-number="28">  on_nth_wday_of_the_quarter</a>
<a class="sourceLine" id="cb10-29" data-line-number="29">}</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">on_last_friday_of_the_quarter &lt;-<span class="st"> </span><span class="kw">make_on_nth_wday_of_the_quarter</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">since =</span> <span class="st">"2000-01-01"</span>, </a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">wday =</span> <span class="st">"Friday"</span>, </a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">nth =</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">fridays &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(<span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, on_last_friday_of_the_quarter)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">fridays</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; [1] "2000-03-31" "2000-06-30" "2000-09-29" "2000-12-29" "2001-03-30"</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; [6] "2001-06-29" "2001-09-28" "2001-12-28"</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span>(fridays, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; [1] Fri Fri Fri Fri Fri Fri Fri Fri</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</span></a></code></pre></div>
</div>
<div id="combining-with-other-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-with-other-rules" class="anchor"></a>Combining with other rules</h2>
<p>Remember that each of these results are just schedules that can be combined with other rules if you need to create more complex quarterly strategies. For example, let’s take the “last Friday of the quarter” schedule and combine it with a rule for “on every Wednesday”.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">on_wednesdays &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rrule.html">weekly</a></span>(<span class="dt">since =</span> <span class="st">"2000-01-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/recur_on_wday.html">recur_on_wday</a></span>(<span class="st">"Wednesday"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">on_last_friday_of_quarter_or_wednesdays &lt;-<span class="st"> </span>on_last_friday_of_the_quarter <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/sch-add.html">sch_add_rrule</a></span>(on_wednesdays)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">last_friday_or_wednesdays &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sch_seq.html">sch_seq</a></span>(</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="st">"2000-01-01"</span>, <span class="st">"2002-01-01"</span>, </a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  on_last_friday_of_quarter_or_wednesdays</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">last_friday_or_wednesdays[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>]</a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  [1] "2000-01-05" "2000-01-12" "2000-01-19" "2000-01-26" "2000-02-02"</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  [6] "2000-02-09" "2000-02-16" "2000-02-23" "2000-03-01" "2000-03-08"</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; [11] "2000-03-15" "2000-03-22" "2000-03-29" "2000-03-31" "2000-04-05"</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">wday</a></span>(last_friday_or_wednesdays[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>], <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;  [1] Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Wed Fri Wed</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#first-day-of-the-quarter">First day of the quarter</a></li>
      <li><a href="#altering-the-fiscal-year-start">Altering the fiscal year start</a></li>
      <li><a href="#n-th-day-of-the-quarter">N-th day of the quarter</a></li>
      <li><a href="#n-th-week-day-of-the-quarter">N-th week day of the quarter</a></li>
      <li><a href="#combining-with-other-rules">Combining with other rules</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
